<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="./panel.css" />
</head>
<body>
  <div class="header">
    <h2 class="title">
      <span>ğŸ–¼ï¸</span>
      <span>TinyPNG Auto Optimizer</span>
    </h2>
  </div>

  <!-- API Key Section -->
  <div class="main-section">
    <div class="input-group">
      <div class="folder-input-row">
        <label class="input-label" for="apiKeyInput">
          <span>ğŸ”‘</span>
          <span>API Key:</span>
        </label>
        <input type="password" id="apiKeyInput" placeholder="Enter your TinyPNG API key..." />
        <button id="btnSaveKey" class="small">
          <span>ğŸ’¾</span>
          <span>Save</span>
        </button>
        <button id="btnLoadKey" class="small">
          <span>ğŸ“‚</span>
          <span>Load</span>
        </button>
      </div>
      <div class="api-key-info">
        <div class="api-info-text">
          <strong>â„¹ï¸ Info:</strong> Get API key 
          <a href="#" id="apiLink" class="api-link">tinypng.com/developers</a>. 
        </div>
        <button id="btnCheckUsage" class="small usage-btn">
          <span>ğŸ“Š</span>
          <span>Check Usage</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Folder Selection Section -->
  <div class="scan-section">
    <!-- Folder Settings Header -->
    <div class="folder-header">
      <h3>ğŸ“ Folder Configuration</h3>
      <button id="btnFolderSettings" class="settings-btn" title="Folder Settings">âš™ï¸</button>
    </div>

    <!-- Settings Panel -->
    <div id="folderSettingsPanel" class="settings-panel" style="display: none;">
      <div class="settings-grid">
        <div class="setting-item">
          <label>
            <input type="checkbox" id="rememberFolders"> 
            Remember last used folders
          </label>
        </div>
        <div class="setting-item">
          <label>
            <input type="checkbox" id="skipEmptyCheck"> 
            Skip empty folder validation
          </label>
        </div>
        <div class="setting-item">
          <label>
            <input type="checkbox" id="autoCreateOutput"> 
            Auto-create "optimize_N" subfolder
          </label>
        </div>
      </div>
      <div class="settings-actions">
        <button id="btnResetFolderSettings" class="danger-btn small">Reset Settings</button>
      </div>
    </div>

    <div class="scan-input">
      <span class="scan-label">ğŸ“ Source:</span>
      <div class="folder-input-container">
        <ui-asset droppable="cc.Asset" id="folderAsset" placeholder="Drag folder here or click to browse..."></ui-asset>
        <div id="sourceFolderStatus" class="folder-status"></div>
      </div>
    </div>

    <div class="scan-input">
      <span class="scan-label">ğŸ’¾ Output:</span>
      <div class="output-folder-container">
        <input type="file" id="outputFolderInput" webkitdirectory style="display: none;" />
        <div class="output-controls">
          <button id="btnSelectOutput" class="folder-select">
            <span>ğŸ“</span>
            <span>Choose Folder</span>
          </button>
          <button id="btnOpenOutput" class="folder-action" title="Open Folder">ğŸ“‚</button>
        </div>
        <div class="output-path-display">
          <span id="outputFolderPath" class="path-text">No folder selected</span>
        </div>
        <div id="outputFolderStatus" class="folder-status"></div>
      </div>
    </div>

    <!-- Combined Analysis & Statistics Panel -->
    <div class="analysis-panel" id="analysisPanel" style="display: none;">
      <div class="panel-header">
        <h3>ğŸ“Š Analysis & Stats</h3>
        <button id="btnCloseAnalysis" class="close-btn" title="Close Panel">âœ•</button>
      </div>
      
      <div class="panel-content">
        <!-- Source Analysis -->
        <div class="analysis-section">
          <div class="section-title">ğŸ“ Source Files</div>
          <div class="compact-stats-grid">
            <div class="compact-stat">
              <span class="stat-icon">ğŸ“</span>
              <span class="stat-value" id="statTotalImages">0</span>
              <span class="stat-label">Total</span>
            </div>
            <div class="compact-stat">
              <span class="stat-icon">ğŸ–¼ï¸</span>
              <span class="stat-value" id="statPngImages">0</span>
              <span class="stat-label">PNG</span>
            </div>
            <div class="compact-stat">
              <span class="stat-icon">ğŸ“·</span>
              <span class="stat-value" id="statJpgImages">0</span>
              <span class="stat-label">JPG</span>
            </div>
            <div class="compact-stat">
              <span class="stat-icon">ğŸŒ</span>
              <span class="stat-value" id="statWebpImages">0</span>
              <span class="stat-label">WebP</span>
            </div>
          </div>
        </div>

        <!-- Image Type Selection -->
        <div class="selection-section">
          <div class="section-title">ğŸ¯ Select Types</div>
          <div class="compact-checkbox-grid">
            <label class="compact-checkbox">
              <input type="checkbox" id="chkPng" checked />
              <span class="checkbox-icon">ğŸ–¼ï¸</span>
              <span>PNG</span>
            </label>
            <label class="compact-checkbox">
              <input type="checkbox" id="chkJpg" checked />
              <span class="checkbox-icon">ğŸ“·</span>
              <span>JPG</span>
            </label>
            <label class="compact-checkbox">
              <input type="checkbox" id="chkWebp" checked />
              <span class="checkbox-icon">ğŸŒ</span>
              <span>WebP</span>
            </label>
          </div>
        </div>

        <!-- Optimization Statistics -->
        <div class="optimization-section" id="optimizationSection" style="display: none;">
          <div class="section-title">ğŸ“ˆ Results</div>
          <div class="compact-stats-grid">
            <div class="compact-stat result-total">
              <span class="stat-icon">ğŸ“</span>
              <span class="stat-value" id="statTotalAssets">0</span>
              <span class="stat-label">Total</span>
            </div>
            <div class="compact-stat result-success">
              <span class="stat-icon">âœ…</span>
              <span class="stat-value" id="statOptimized">0</span>
              <span class="stat-label">Done</span>
            </div>
            <div class="compact-stat result-error">
              <span class="stat-icon">âŒ</span>
              <span class="stat-value" id="statErrors">0</span>
              <span class="stat-label">Error</span>
            </div>
            <div class="compact-stat result-saved">
              <span class="stat-icon">ğŸ’¾</span>
              <span class="stat-value" id="statSavedSize">0 MB</span>
              <span class="stat-label">Saved</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="main-controls">
      <button id="btnRun" class="primary">
        <span>ğŸš€</span>
        <span>Run Optimization</span>
      </button>
      <div class="run-options">
        <label>
          <input type="checkbox" id="processAnyway"> 
          Process even if validation fails
        </label>
      </div>
    </div>
  </div>

  <!-- Progress Section -->
  <div class="progress-container" id="progressContainer" style="display: none;">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="progress-text" id="progressText">Ready to optimize...</div>
  </div>

  <!-- Statistics Section -->
  <div class="stats-section" id="statsSection">
    <div class="stats-title">
      <span>ğŸ“Š</span>
      <span>Optimization Statistics</span>
    </div>
    <div class="stats-grid">
      <div class="stat-item stat-total">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-content">
          <div class="stat-number" id="statTotalAssets">0</div>
          <div class="stat-label">Total Assets</div>
        </div>
      </div>
      <div class="stat-item stat-success">
        <div class="stat-icon">âœ…</div>
        <div class="stat-content">
          <div class="stat-number" id="statOptimized">0</div>
          <div class="stat-label">Optimized</div>
        </div>
      </div>
      <div class="stat-item stat-error">
        <div class="stat-icon">âŒ</div>
        <div class="stat-content">
          <div class="stat-number" id="statErrors">0</div>
          <div class="stat-label">Errors</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Log Section -->
  <div class="results-section">
    <div class="results-header">
      <span>ğŸ“ Optimization Log</span>
      <div class="results-controls">
        <button id="btnClearLog" class="small">ğŸ§¹ Clear</button>
      </div>
    </div>
    <div class="results-body" id="log"></div>
  </div>
</body>
</html>